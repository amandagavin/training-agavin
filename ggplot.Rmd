---
title: "Data Viz"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r}
library(leaflet)
library(dplyr)
library(tidyr)
library(ggplot2)
library(DT)
library(scales)
```
salmon escapement data

```{r}
data_url <- "https://knb.ecoinformatics.org/knb/d1/mn/v2/object/urn%3Auuid%3Af119a05b-bbe7-4aea-93c6-85434dcb1c5e"

esc <- tryCatch(
    read.csv("data/escapement.csv"),
    error=function(cond) {
        message(paste("Escapement file does not seem to exist, so get it from the KNB."))
        esc <- read.csv(url(data_url, method = "libcurl"))
        return(esc)
    }
)

head(esc)
```

tryCatch tries to run code, if it gets an error, you can give it an error condition. 
might do this if you have the file locally and then if youd ont have it, it will grab it from the KNB
this makes code more robust and help increase reproducibility because code comes from archive and using local file means you don't have to download the file


calculate annual escapement by species and region
need to use separate because there is not a column for year

```{r}
annual_esc <- esc %>% 
  separate(sampleDate, into = c("Year", "Day"), sep = "-")
```
head(annual_esc)

annual_esc %>% select (Species, SASAP.Region, DailyCount, Year) %>%  group_by (Species, SASAP.Region, Year) %>% summarise(Sum = sum(DailyCount),
 .groups = "drop")


use %in% instead of using == and | or

```{r}
annual_esc <- esc %>% 
  separate(sampleDate, into = c("Year", "Day"), sep = "-") %>% mutate( Year = as.numeric(Year)) %>% 
  group_by(Species, SASAP.Region, Year) %>% 
  summarise((escapement = sum(DailyCount) %>% 
               filter(Species %in% c("Sockeye", "Chinook",
                                     "Coho", "Pink", "Chum"))
             ))
```


```{r}
annual_esc <- esc %>% 
  separate(sampleDate, c("Year", "Month", "Day"), sep = "-") %>% 
  mutate(Year = as.numeric(Year)) %>% 
  group_by(Species, SASAP.Region, Year) %>% 
  summarize(escapement = sum(DailyCount)) %>% 
  filter(Species %in% c("Chinook", "Sockeye", "Chum", "Coho", "Pink"))
```


##ggplot
```{r}
ggplot (annual_esc, mapping = aes(x = Species, y = escapement))+ 
  geom_col(fill = "lightblue")

annual_esc$SASAP.Region
```


```{r}
kodiak_esc <- annual_esc %>% filter(SASAP.Region == "Kodiak")
```


```{r}
ggplot(kodiak_esc, aes (x = Year, y = escapement, color = Species)) + 
  geom_point() + 
  geom()
```
```{r}
annual_esc %>% 
  filter(SASAP.Region == "Kodiak") %>% 
ggplot(aes(x = Year, y = escapement, color = Species)) + 
    geom_line() +
    geom_point()+
  scale_color_brewer(palette = "Dark2") +
  scale_y_continuous(labels = comma, n.breaks = 4)+
  ylab("Escapement (num fish)") +
  ggtitle("Kodiak Escapement") +
  theme_bw()+
  theme(legend.position = "bottom")
```

order matters in theme

and my_theme


```{r}
locations <- esc %>% 
  distinct(Location, Latitude, Longitude) %>% 
  drop_na
```

```{r}
leaflet(locations) %>% 
  addTiles() %>% 
  addMarkers(lng = ~Longitude, lat = ~Latitude, popup = ~Location)
```
add plots when you hover over a point maybe using add functions
